<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.rayton.gps.dao.baseinfo.sim.ISimcardDao">
    <select id="queryPageCount" resultType="java.lang.Integer">
        SELECT COUNT(1)
        FROM
        simcard
        WHERE COMPANYID = #{0} AND (SIMCARDNUMBER LIKE
        CONCAT('%', #{1}, '%') OR
        CARRIEROPERATOR LIKE CONCAT('%', #{1}, '%') OR
        PHONENUMBER LIKE CONCAT('%', #{1}, '%'))
    </select>
    <select id="queryPageDetail" resultType="com.rayton.gps.dao.baseinfo.sim.Simcard">
        SELECT
        ID,
        PHONENUMBER,
        SIMCARDNUMBER,
        SPEECHTYPE,
        OPENSMS,
        PURCHASEDATE,
        CARRIEROPERATOR,
        PREPAYMENT,
        EXPIREDATE,
        CREATETIME,
        REMARK,


        ACCOUNTNAME,
        MONTHLYRENT,
        INSTOCKDATE,
        OUTSTOCKDATE,
        EXPIRENOTIFYDATE


        FROM
        simcard
        WHERE
        COMPANYID = #{0} AND (SIMCARDNUMBER
        LIKE CONCAT('%', #{1}, '%') OR
        CARRIEROPERATOR LIKE CONCAT('%', #{1}, '%')
        OR PHONENUMBER LIKE
        CONCAT('%', #{1}, '%'))
        ORDER BY PHONENUMBER
        LIMIT
        #{2}, #{3}
    </select>
    <insert id="create" parameterType="com.rayton.gps.dao.baseinfo.sim.Simcard">
        INSERT INTO simcard (ID,
        COMPANYID, PHONENUMBER, SIMCARDNUMBER, SPEECHTYPE,
        OPENSMS, OPENDATE,
        PURCHASEDATE, CARRIEROPERATOR, PREPAYMENT,
        EXPIREDATE, FLOWSET,
        CREATETIME, REMARK,

        ACCOUNTNAME,
        MONTHLYRENT,
        INSTOCKDATE,
        OUTSTOCKDATE,
        EXPIRENOTIFYDATE


        ) VALUES (#{id}, #{companyId}, #{phoneNumber},
        #{simcardNumber}, #{speechType}, #{openSMS},
        #{openDate},
        #{purchaseDate}, #{carrierOperator}, #{prepayment},
        #{expireDate},
        #{flowset}, SYSDATE(), #{remark},

        #{ACCOUNTNAME},
        #{MONTHLYRENT},
        #{INSTOCKDATE},
        #{OUTSTOCKDATE},
        #{EXPIRENOTIFYDATE}


        )
    </insert>
    <update id="update" parameterType="com.rayton.gps.dao.baseinfo.sim.Simcard">
        UPDATE simcard
        SET
        COMPANYID = #{companyId}, PHONENUMBER = #{phoneNumber},
        SIMCARDNUMBER = #{simcardNumber},
        SPEECHTYPE = #{speechType}, OPENSMS = #{openSMS}, OPENDATE = #{openDate},
        PURCHASEDATE = #{purchaseDate},
        CARRIEROPERATOR = #{carrierOperator},
        PREPAYMENT = #{prepayment}, EXPIREDATE = #{expireDate},
        FLOWSET = #{flowset}, REMARK = #{remark},


        ACCOUNTNAME = #{ACCOUNTNAME},
        MONTHLYRENT = #{MONTHLYRENT},
        INSTOCKDATE = #{INSTOCKDATE},
        OUTSTOCKDATE = #{OUTSTOCKDATE},
        EXPIRENOTIFYDATE = #{EXPIRENOTIFYDATE}


        WHERE ID = #{id} AND
        EDITTIME = #{editTime}
        LIMIT 1
    </update>
    <select id="assignedDevice" resultType="java.lang.String">
        SELECT DEVICENUMBER
        FROM
        equipment
        WHERE SIMCARDID = #{0}
        LIMIT 1
    </select>
    <delete id="delete">
        DELETE FROM simcard
        WHERE ID = #{0}
    </delete>
    <select id="fetch" resultType="com.rayton.gps.dao.baseinfo.sim.Simcard">
        SELECT
        ID,
        COMPANYID,
        PHONENUMBER,
        SIMCARDNUMBER,
        SPEECHTYPE,
        OPENSMS,
        OPENDATE,
        PURCHASEDATE,
        CARRIEROPERATOR,
        PREPAYMENT,
        EXPIREDATE,
        FLOWSET,
        CREATETIME,
        REMARK,
        EDITTIME,
        ACCOUNTNAME,
        MONTHLYRENT,
        INSTOCKDATE,
        OUTSTOCKDATE,
        EXPIRENOTIFYDATE
        FROM simcard
        WHERE ID = #{0}
        LIMIT 1
    </select>
    <select id="exist" resultType="java.lang.Boolean">
        SELECT COUNT(1)
        FROM simcard
        WHERE
        PHONENUMBER = #{0}
        LIMIT 1
    </select>
    <select id="existOutId" resultType="java.lang.Boolean">
        SELECT COUNT(1)
        FROM simcard
        WHERE PHONENUMBER = #{0} AND ID != #{1}
        LIMIT 1
    </select>
    <select id="searchPageCount" resultType="java.lang.Integer">
        SELECT COUNT(1)
        FROM
        simcard
        WHERE COMPANYID = #{0} AND
        PHONENUMBER LIKE
        CONCAT('%', #{1}, '%')
    </select>
    <select id="searchPageDetail" resultType="com.rayton.gps.dao.baseinfo.sim.SimcardSearchInfo">
        SELECT
        ID,
        PHONENUMBER,
        SPEECHTYPE,
        OPENSMS,
        CARRIEROPERATOR,
        REMARK,
        ACCOUNTNAME,
        MONTHLYRENT,
        INSTOCKDATE,
        OUTSTOCKDATE,
        EXPIRENOTIFYDATE
        FROM
        simcard
        WHERE
        COMPANYID = #{0} AND PHONENUMBER LIKE CONCAT('%', #{1}, '%')
        ORDER BY
        SIMCARDNUMBER
        LIMIT #{2}, #{3}
    </select>
    <select id="freePageCount" resultType="java.lang.Integer">
        SELECT COUNT(1)
        FROM
        simcard
        WHERE ID NOT IN (SELECT SIMCARDID
        FROM equipment
        WHERE
        COMPANYID = #{0}) AND COMPANYID = #{0} AND PHONENUMBER LIKE
        CONCAT('%', #{1}, '%')
    </select>
    <select id="freePageDetail" resultType="com.rayton.gps.dao.baseinfo.sim.SimcardSearchInfo">
        SELECT
        ID,
        PHONENUMBER,
        SPEECHTYPE,
        OPENSMS,
        CARRIEROPERATOR,
        REMARK,
        ACCOUNTNAME,
        MONTHLYRENT,
        INSTOCKDATE,
        OUTSTOCKDATE,
        EXPIRENOTIFYDATE
        FROM
        simcard
        WHERE ID NOT
        IN (SELECT SIMCARDID
        FROM equipment
        WHERE
        COMPANYID = #{0}) AND
        COMPANYID = #{0} AND PHONENUMBER LIKE CONCAT('%', #{1}, '%')
        ORDER BY
        SIMCARDNUMBER
        LIMIT #{2}, #{3}
    </select>
</mapper>