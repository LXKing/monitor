<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.edata.monitor.dao.baseinfo.IRouteAreaDao">
	<select id="queryPageCount" resultType="java.lang.Integer">
		SELECT COUNT(1) FROM
		route WHERE COMPANYID=#{0} AND NAME LIKE CONCAT('%',#{1},'%')
	</select>
	<select id="queryPageDetail" resultType="com.edata.monitor.dao.baseinfo.RouteAreaInfoDto">
		SELECT ID, NAME,
		DEVICECATCH, REMARK FROM route WHERE COMPANYID=#{0} AND NAME
		LIKE
		CONCAT('%',#{1},'%') ORDER BY NAME LIMIT #{2},#{3}
	</select>
	<select id="searchPageCount" resultType="java.lang.Integer">
		SELECT COUNT(1) FROM
		route WHERE COMPANYID=#{0} AND NAME LIKE
		CONCAT('%',#{1},'%')
	</select>
	<select id="searchPageDetail" resultType="com.edata.monitor.dao.baseinfo.RouteAreaInfoDto">
		SELECT ID, NAME,
		DEVICECATCH, REMARK FROM route WHERE COMPANYID=#{0} AND NAME
		LIKE
		CONCAT('%',#{1},'%') ORDER BY NAME LIMIT #{2},#{3}
	</select>
	<insert id="create" parameterType="com.edata.monitor.dao.baseinfo.RouteAreaDto">
		INSERT INTO route(COMPANYID,
		NAME, DEVICECATCH, FLAG, STARTTIME, ENDTIME,
		REMARK)
		VALUES(#{companyId}, #{name},
		#{deviceCatch}, #{flag}, #{startTime},
		#{endTime}, #{remark})
	</insert>
	<select id="fetch" resultType="com.edata.monitor.dao.baseinfo.RouteAreaDto">
		SELECT ID, COMPANYID, NAME,
		DEVICECATCH, FLAG, STARTTIME, ENDTIME, REMARK,
		EDITTIME FROM route
		WHERE ID=#{0} LIMIT 1
	</select>
	<update id="update" parameterType="com.edata.monitor.dao.baseinfo.RouteAreaDto">
		UPDATE route SET
		COMPANYID=#{companyId}, NAME=#{name}, DEVICECATCH=#{deviceCatch},
		FLAG=#{flag}, STARTTIME=#{startTime}, ENDTIME=#{endTime},
		REMARK=#{remark}
		WHERE ID=#{id} AND EDITTIME=#{editTime} LIMIT 1
	</update>
	<delete id="delete">
		DELETE FROM route WHERE ID=#{0} LIMIT 1
	</delete>
	<delete id="deleteRouteSection">
		DELETE FROM routesection WHERE ROUTEID=#{0}
	</delete>
	<select id="exist" resultType="java.lang.Boolean">
		SELECT COUNT(1) FROM route WHERE
		NAME=#{0} AND COMPANYID=#{1} LIMIT 1
	</select>
	<select id="existOutId" resultType="java.lang.Boolean">
		SELECT COUNT(1) FROM route
		WHERE NAME=#{0} AND COMPANYID=#{1} AND ID != #{2} LIMIT 1
	</select>
	<select id="assignedSections" resultType="com.edata.monitor.dao.baseinfo.SectionAreaInfoDto">
		SELECT ID,NAME,REMARK
		FROM section INNER JOIN routesection ON
		section.ID=routesection.SECTIONID WHERE routesection.ROUTEID=#{0}
	</select>
	<insert id="addSections">
		REPLACE INTO routesection(ROUTEID, SECTIONID) VALUES
		<foreach collection="list" item="item" separator=",">
			(#{item.key},#{item.value})
		</foreach>
	</insert>
	<delete id="removeSection">
		DELETE FROM routesection WHERE ROUTEID=#{0} AND
		SECTIONID=#{1} LIMIT 1
	</delete>
	<select id="fetchInfo" resultType="com.edata.monitor.dao.baseinfo.RouteAreaInfoDto">
		SELECT ID, NAME, DEVICECATCH,
		REMARK FROM route WHERE ID=#{0} LIMIT 1
	</select>
</mapper>