<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.edata.monitor.dao.baseinfo.ISimcardDao">
	<select id="queryPageCount" resultType="java.lang.Integer">
		SELECT COUNT(1) FROM
		simcard WHERE COMPANYID=#{0} AND (SIMCARDNUMBER LIKE
		CONCAT('%',#{1},'%') OR
		CARRIEROPERATOR LIKE CONCAT('%',#{1},'%') OR
		PHONENUMBER LIKE CONCAT('%',#{1},'%'))
	</select>
	<select id="queryPageDetail" resultType="com.edata.monitor.dao.baseinfo.SimcardDto">
		SELECT ID, PHONENUMBER,
		SIMCARDNUMBER, SPEECHTYPE,
		OPENSMS, PURCHASEDATE,
		CARRIEROPERATOR,
		PREPAYMENT, EXPIREDATE,
		CREATETIME, REMARK FROM
		simcard WHERE
		COMPANYID=#{0} AND (SIMCARDNUMBER
		LIKE CONCAT('%',#{1},'%') OR
		CARRIEROPERATOR LIKE CONCAT('%',#{1},'%')
		OR PHONENUMBER LIKE
		CONCAT('%',#{1},'%')) ORDER BY PHONENUMBER
		LIMIT
		#{2},#{3}
	</select>
	<insert id="create" parameterType="com.edata.monitor.dao.baseinfo.SimcardDto">
		INSERT INTO simcard(ID,
		COMPANYID, PHONENUMBER, SIMCARDNUMBER, SPEECHTYPE,
		OPENSMS, OPENDATE,
		PURCHASEDATE, CARRIEROPERATOR, PREPAYMENT,
		EXPIREDATE, FLOWSET,
		CREATETIME, REMARK) VALUES (#{id}, #{companyId}, #{phoneNumber},
		#{simcardNumber}, #{speechType}, #{openSMS}, #{openDate},
		#{purchaseDate}, #{carrierOperator}, #{prepayment}, #{expireDate},
		#{flowset}, SYSDATE(), #{remark})
	</insert>
	<update id="update" parameterType="com.edata.monitor.dao.baseinfo.SimcardDto">
		UPDATE simcard SET
		COMPANYID=#{companyId}, PHONENUMBER=#{phoneNumber},
		SIMCARDNUMBER=#{simcardNumber},
		SPEECHTYPE=#{speechType},OPENSMS=#{openSMS},OPENDATE=#{openDate},
		PURCHASEDATE=#{purchaseDate},
		CARRIEROPERATOR=#{carrierOperator},
		PREPAYMENT=#{prepayment}, EXPIREDATE=#{expireDate},
		FLOWSET=#{flowset}, REMARK=#{remark}
		WHERE ID=#{id} AND
		EDITTIME=#{editTime}
		LIMIT 1
	</update>
	<select id="assignedDevice" resultType="java.lang.String">
		SELECT DEVICENUMBER FROM
		device WHERE SIMCARDID=#{0} LIMIT 1
	</select>
	<delete id="delete">
		DELETE FROM simcard WHERE ID=#{0}
	</delete>
	<select id="fetch" resultType="com.edata.monitor.dao.baseinfo.SimcardDto">
		SELECT ID, COMPANYID, PHONENUMBER,
		SIMCARDNUMBER, SPEECHTYPE, OPENSMS, OPENDATE,
		PURCHASEDATE,
		CARRIEROPERATOR, PREPAYMENT, EXPIREDATE, FLOWSET,
		CREATETIME, REMARK,
		EDITTIME FROM simcard WHERE ID=#{0} LIMIT 1
	</select>
	<select id="exist" resultType="java.lang.Boolean">
		SELECT COUNT(1) FROM simcard WHERE
		PHONENUMBER = #{0} LIMIT 1
	</select>
	<select id="existOutId" resultType="java.lang.Boolean">
		SELECT COUNT(1) FROM simcard
		WHERE PHONENUMBER = #{0} AND ID != #{1} LIMIT 1
	</select>
	<select id="searchPageCount" resultType="java.lang.Integer">
		SELECT COUNT(1) FROM
		simcard WHERE COMPANYID=#{0} AND
		PHONENUMBER LIKE
		CONCAT('%',#{1},'%')
	</select>
	<select id="searchPageDetail" resultType="com.edata.monitor.dao.baseinfo.SimcardSearchInfoDto">
		SELECT ID, PHONENUMBER,
		SPEECHTYPE, OPENSMS, CARRIEROPERATOR, REMARK FROM
		simcard WHERE
		COMPANYID = #{0} AND PHONENUMBER LIKE CONCAT('%',#{1},'%') ORDER BY
		SIMCARDNUMBER LIMIT #{2},#{3}
	</select>
	<select id="freePageCount" resultType="java.lang.Integer">
		SELECT COUNT(1) FROM
		simcard WHERE ID NOT IN (SELECT SIMCARDID FROM device
		WHERE
		COMPANYID=#{0}) AND COMPANYID=#{0} AND PHONENUMBER LIKE
		CONCAT('%',#{1},'%')
	</select>
	<select id="freePageDetail" resultType="com.edata.monitor.dao.baseinfo.SimcardSearchInfoDto">
		SELECT ID, PHONENUMBER,
		SPEECHTYPE, OPENSMS, CARRIEROPERATOR, REMARK FROM
		simcard WHERE ID NOT
		IN (SELECT SIMCARDID FROM device WHERE
		COMPANYID=#{0}) AND
		COMPANYID=#{0} AND PHONENUMBER LIKE CONCAT('%',#{1},'%') ORDER BY
		SIMCARDNUMBER LIMIT #{2},#{3}
	</select>
</mapper>