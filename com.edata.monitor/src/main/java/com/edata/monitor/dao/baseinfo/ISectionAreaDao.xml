<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.edata.monitor.dao.baseinfo.ISectionAreaDao">
	<select id="queryPageCount" resultType="java.lang.Integer">
		SELECT COUNT(1) FROM
		section WHERE COMPANYID=#{0} AND NAME LIKE CONCAT('%',#{1},'%')
	</select>
	<select id="queryPageDetail" resultType="com.edata.monitor.dao.baseinfo.SectionAreaInfoDto">
		SELECT ID, NAME, REMARK
		FROM section WHERE COMPANYID=#{0} AND NAME LIKE CONCAT('%',#{1},'%')
		ORDER BY NAME LIMIT #{2},#{3}
	</select>
	<select id="searchPageCount" resultType="java.lang.Integer">
		SELECT COUNT(1) FROM
		section WHERE COMPANYID=#{0} AND NAME LIKE CONCAT('%',#{1},'%')
	</select>
	<select id="searchPageDetail" resultType="com.edata.monitor.dao.baseinfo.SectionAreaInfoDto">
		SELECT ID, NAME, REMARK
		FROM section WHERE COMPANYID=#{0} AND NAME LIKE CONCAT('%',#{1},'%')
		ORDER
		BY NAME LIMIT #{2},#{3}
	</select>
	<insert id="create" useGeneratedKeys="true" keyProperty="id"
		parameterType="com.edata.monitor.dao.baseinfo.SectionAreaDto">
		INSERT INTO section(COMPANYID, NAME, WIDTH, FLAG,
		MAXSECONDS, MINSECONDS,
		MAXSPEED, OVERSPEEDSECONDS, REMARK) VALUES
		(#{companyId}, #{name}, #{width}, #{flag}, #{maxSeconds},
		#{minSeconds}, #{maxSpeed}, #{overspeedSeconds}, #{remark})
	</insert>
	<select id="fetch" resultType="com.edata.monitor.dao.baseinfo.SectionAreaDto">
		SELECT ID, COMPANYID, NAME, WIDTH,
		FLAG, MAXSECONDS, MINSECONDS, MAXSPEED,
		OVERSPEEDSECONDS, REMARK,
		EDITTIME FROM section WHERE ID=#{0} LIMIT 1
	</select>
	<update id="update">
		UPDATE section SET
		COMPANYID=#{companyId},
		NAME=#{name}, WIDTH=#{width}, FLAG=#{flag}, MAXSECONDS=#{maxSeconds},
		MINSECONDS=#{minSeconds},
		MAXSPEED=#{maxSpeed},
		OVERSPEEDSECONDS=#{overspeedSeconds}, REMARK=#{remark}
		WHERE ID=#{id}
		AND
		EDITTIME=#{editTime} LIMIT 1
	</update>
	<delete id="delete">
		DELETE FROM section WHERE ID=#{0} LIMIT 1
	</delete>
	<insert id="createSectionPoint">
		INSERT INTO sectionpoint(SECTIONID, LAT, LNG, `INDEX`) VALUES
		<foreach collection="list" item="item" separator=",">
			(#{item.sectionId},#{item.lat},#{item.lng},#{item.index})
		</foreach>
	</insert>
	<select id="fetchSectionPoint" resultType="com.edata.monitor.dao.baseinfo.SectionPointDto">
		SELECT ID, LAT, LNG,
		SECTIONID, `INDEX` FROM sectionpoint WHERE SECTIONID=#{0}
		ORDER BY
		`INDEX`
	</select>
	<delete id="deleteSectionPoint">
		DELETE FROM sectionpoint WHERE SECTIONID=#{0}
	</delete>
	<select id="existOutId" resultType="java.lang.Boolean">
		SELECT COUNT(1) FROM section
		WHERE NAME=#{0} AND
		COMPANYID=#{1} AND ID != #{2} LIMIT 1
	</select>
	<select id="exist" resultType="java.lang.Boolean">
		SELECT COUNT(1) FROM section WHERE
		NAME=#{0} AND
		COMPANYID=#{1} LIMIT 1
	</select>
</mapper>