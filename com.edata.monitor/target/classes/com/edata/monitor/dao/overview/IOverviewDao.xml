<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.edata.monitor.dao.overview.IOverviewDao">
    <select id="companyServiceOverview" resultType="java.lang.Integer">
        SELECT COUNT(1) FROM user WHERE SERVICEENDDATE &lt;
        SYSDATE() AND
        user.ID IN
        <foreach item="item" index="index" collection="list" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>
    <select id="companyServiceOverviewDays" parameterType="com.edata.monitor.util.KeyValue"
            resultType="java.lang.Integer">
        SELECT COUNT(1) FROM user WHERE SERVICEENDDATE BETWEEN
        NOW() AND
        date_add(NOW(), interval #{key} day) AND
        user.ID IN
        <foreach item="item" index="index" collection="value" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>

    <select id="vehicleServiceOverview" resultType="java.lang.Integer">
        SELECT COUNT(1) FROM user INNER JOIN device ON user.ID=device.ID WHERE
        user.SERVICEENDDATE &lt; SYSDATE() AND
        device.DEVICENUMBER IN
        <foreach item="item" index="index" collection="list" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>

    <select id="vehicleServiceOverviewDays" resultType="java.lang.Integer">
        SELECT COUNT(1) FROM user INNER JOIN device ON user.ID=device.ID WHERE
        user.SERVICEENDDATE BETWEEN NOW() AND date_add(NOW(), interval #{key}
        day)
        AND device.DEVICENUMBER IN
        <foreach item="item" index="index" collection="value" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>

    <select id="vehicleCheckOverview" resultType="java.lang.Integer">
        SELECT COUNT(1) FROM vehicle WHERE ANNUALSURVEYDATE &lt; SYSDATE() AND
        vehicle.ID IN
        <foreach item="item" index="index" collection="list" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>
    <select id="vehicleCheckOverviewDays" resultType="java.lang.Integer">
        SELECT COUNT(1) FROM vehicle WHERE ANNUALSURVEYDATE BETWEEN NOW() AND
        date_add(NOW(), interval #{key} day) AND
        vehicle.ID IN
        <foreach item="item" index="index" collection="value" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>

    <select id="vehicleMaintainOverview" resultType="java.lang.Integer">
        SELECT COUNT(1) FROM vehicle WHERE NEXTMAINTAINDATE &lt; SYSDATE() AND
        vehicle.ID IN
        <foreach item="item" index="index" collection="list" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>
    <select id="vehicleMaintainOverviewDays" resultType="java.lang.Integer">
        SELECT COUNT(1) FROM vehicle WHERE NEXTMAINTAINDATE BETWEEN NOW() AND
        date_add(NOW(), interval #{key} day) AND vehicle.ID IN
        <foreach item="item" index="index" collection="value" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>

    <resultMap type="com.edata.monitor.dao.baseinfo.company.CompanyInfo"
               id="CompanyInfoDtoMap">
        <id column="ID" jdbcType="VARCHAR"></id>
        <result column="ENABLE" property="enable" jdbcType="BOOLEAN"/>
        <result column="SERVICESTARTDATE" property="serviceStartDate"
                jdbcType="DATE"/>
        <result column="SERVICEENDDATE" property="serviceEndDate"
                jdbcType="DATE"/>
        <result column="CREATETIME" property="createTime" jdbcType="DATE"/>
        <result column="REMARK" property="remark" jdbcType="VARCHAR"/>
        <result column="FULLNAME" property="fullName" jdbcType="VARCHAR"/>
        <result column="SHORTNAME" property="shortName" jdbcType="VARCHAR"/>
        <result column="OFFICEADDRESS" property="officeAddress"
                jdbcType="VARCHAR"/>
        <result column="ONDUTYPHONE" property="ondutyPhone" jdbcType="VARCHAR"/>
    </resultMap>

    <select id="companyServiceExpired" resultMap="CompanyInfoDtoMap">
        SELECT A.ID, A.`ENABLE`, A.SERVICESTARTDATE, A.SERVICEENDDATE,
        A.CREATETIME,
        A.REMARK, B.FULLNAME, B.SHORTNAME, B.OFFICEADDRESS,
        B.ONDUTYPHONE FROM
        user A INNER JOIN company B ON A.ID = B.ID WHERE
        A.SERVICEENDDATE &lt; SYSDATE() AND A.ID IN
        <foreach item="item" index="index" collection="list" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>

    <select id="companyServiceExpiredDays" resultMap="CompanyInfoDtoMap">
        SELECT A.ID, A.`ENABLE`, A.SERVICESTARTDATE, A.SERVICEENDDATE,
        A.CREATETIME,
        A.REMARK, B.FULLNAME, B.SHORTNAME, B.OFFICEADDRESS,
        B.ONDUTYPHONE FROM
        user A INNER JOIN company B ON A.ID = B.ID WHERE
        A.SERVICEENDDATE
        BETWEEN NOW() AND date_add(NOW(), interval #{key} day)
        AND A.ID IN
        <foreach item="item" index="index" collection="value" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>
    <select id="vehicleServiceExpired" resultType="com.edata.monitor.dao.baseinfo.vehicle.VehicleInfoDto">
        SELECT A.ID,
        B.DEVICENUMBER, C.PHONENUMBER, A.PLATENUMBER,
        A.PLATECOLOR,
        A.INSTALLDATE, A.ANNUALSURVEYDATE, A.MARKER, A.REMARK,
        D.NAME AS
        MOTORCADE, E.SERVICESTARTDATE, E.SERVICEENDDATE FROM vehicle
        AS A LEFT
        JOIN device AS B ON A.DEVICEID=B.ID LEFT JOIN simcard AS C ON
        B.SIMCARDID=C.ID LEFT JOIN motorcade AS D ON A.MOTORCADEID=D.ID LEFT
        JOIN user AS E ON B.ID=E.ID WHERE E.SERVICEENDDATE &lt; SYSDATE() AND
        A.ID IN
        <foreach item="item" index="index" collection="list" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>
    <select id="vehicleServiceExpiredDays" resultType="com.edata.monitor.dao.baseinfo.vehicle.VehicleInfoDto">
        SELECT A.ID, B.DEVICENUMBER, C.PHONENUMBER, A.PLATENUMBER,
        A.PLATECOLOR,
        A.INSTALLDATE, A.ANNUALSURVEYDATE, A.MARKER, A.REMARK,
        D.NAME AS
        MOTORCADE, E.SERVICESTARTDATE, E.SERVICEENDDATE FROM vehicle
        AS A LEFT
        JOIN device AS B ON A.DEVICEID=B.ID LEFT JOIN simcard AS C ON
        B.SIMCARDID=C.ID LEFT JOIN motorcade AS D ON A.MOTORCADEID=D.ID LEFT
        JOIN user AS E ON B.ID=E.ID WHERE E.SERVICEENDDATE BETWEEN NOW() AND
        date_add(NOW(), interval #{key} day)
        AND A.ID IN
        <foreach item="item" index="index" collection="value" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>
    <select id="vehicleMaintainExpired" resultType="com.edata.monitor.dao.baseinfo.vehicle.VehicleInfoDto">
        SELECT A.ID, B.DEVICENUMBER, C.PHONENUMBER, A.PLATENUMBER,
        A.PLATECOLOR,
        A.INSTALLDATE, A.NEXTMAINTAINDATE, A.MARKER, A.REMARK,
        D.NAME AS
        MOTORCADE FROM vehicle AS A LEFT JOIN device AS B ON
        A.DEVICEID=B.ID
        LEFT JOIN simcard AS C ON B.SIMCARDID=C.ID LEFT JOIN
        motorcade AS D ON
        A.MOTORCADEID=D.ID WHERE A.NEXTMAINTAINDATE &lt;
        SYSDATE() AND
        A.ID IN
        <foreach item="item" index="index" collection="list" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>
    <select id="vehicleMaintainExpiredDays" resultType="com.edata.monitor.dao.baseinfo.vehicle.VehicleInfoDto">
        SELECT A.ID, B.DEVICENUMBER, C.PHONENUMBER, A.PLATENUMBER,
        A.PLATECOLOR,
        A.INSTALLDATE, A.NEXTMAINTAINDATE, A.MARKER, A.REMARK,
        D.NAME AS
        MOTORCADE FROM vehicle AS A LEFT JOIN device AS B ON
        A.DEVICEID=B.ID
        LEFT JOIN simcard AS C ON B.SIMCARDID=C.ID LEFT JOIN
        motorcade AS D ON
        A.MOTORCADEID=D.ID WHERE A.NEXTMAINTAINDATE BETWEEN
        NOW() AND date_add(NOW(), interval #{key} day)
        AND A.ID IN
        <foreach item="item" index="index" collection="value" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>
    <select id="vehicleAnnualSurveyExpired" resultType="com.edata.monitor.dao.baseinfo.vehicle.VehicleInfoDto">
        SELECT A.ID,
        B.DEVICENUMBER, C.PHONENUMBER, A.PLATENUMBER,
        A.PLATECOLOR,
        A.INSTALLDATE, A.ANNUALSURVEYDATE, A.MARKER, A.REMARK,
        D.NAME AS
        MOTORCADE FROM vehicle AS A LEFT JOIN device AS B ON
        A.DEVICEID=B.ID
        LEFT JOIN simcard AS C ON B.SIMCARDID=C.ID LEFT JOIN
        motorcade AS D ON
        A.MOTORCADEID=D.ID WHERE A.ANNUALSURVEYDATE &lt;
        SYSDATE() AND
        A.ID IN
        <foreach item="item" index="index" collection="list" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>
    <select id="vehicleAnnualSurveyExpiredDays" resultType="com.edata.monitor.dao.baseinfo.vehicle.VehicleInfoDto">
        SELECT A.ID, B.DEVICENUMBER, C.PHONENUMBER, A.PLATENUMBER,
        A.PLATECOLOR,
        A.INSTALLDATE, A.ANNUALSURVEYDATE, A.MARKER, A.REMARK,
        D.NAME AS
        MOTORCADE FROM vehicle AS A LEFT JOIN device AS B ON
        A.DEVICEID=B.ID
        LEFT JOIN simcard AS C ON B.SIMCARDID=C.ID LEFT JOIN
        motorcade AS D ON
        A.MOTORCADEID=D.ID WHERE A.ANNUALSURVEYDATE BETWEEN
        NOW() AND date_add(NOW(), interval #{key} day) AND
        A.ID IN
        <foreach item="item" index="index" collection="value" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>
</mapper>