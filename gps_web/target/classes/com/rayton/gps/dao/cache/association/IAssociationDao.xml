<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.rayton.gps.dao.cache.association.IAssociationDao">
    <resultMap type="com.rayton.gps.dao.cache.association.MonitorTarget"
               id="MonitorTargetDtoMap">
        <result property="id" column="ID" jdbcType="VARCHAR"/>
        <result property="pid" column="PID" jdbcType="VARCHAR"/>
        <result property="type" column="TYPE" jdbcType="INTEGER"/>
        <result property="name" column="NAME" jdbcType="VARCHAR"/>
    </resultMap>
    <select id="loadUserMonitors" resultMap="MonitorTargetDtoMap">
        SELECT
        A.ID,
        B.USERID AS PID,
        A.NAME,
        1 AS `TYPE`
        FROM
        motorcade AS A
        INNER
        JOIN usermonitor AS B
        ON B.TARGETID = A.ID
        WHERE B.USERID = #{0}
        UNION
        SELECT
        C.ID,
        D.USERID AS
        PID,
        C.SHORTNAME AS N,
        2 AS `TYPE`
        FROM company AS C
        INNER JOIN
        usermonitor AS D ON D.TARGETID = C.ID
        WHERE D.USERID = #{0} AND
        C.PARENTVISIBLE = 1
    </select>

    <select id="loadSubUserMonitors" resultMap="MonitorTargetDtoMap">
        SELECT
        ID,
        COMPANYID
        AS PID,
        NAME,
        1 AS `TYPE`
        FROM motorcade
        WHERE PARENTVISIBLE = 1 AND
        COMPANYID = #{0}
        UNION SELECT
        A.ID,
        B.PID,
        A.SHORTNAME AS N,
        2 AS `TYPE`
        FROM
        company AS A INNER JOIN user AS B ON A.ID = B.ID
        WHERE A.PARENTVISIBLE = 1
        AND B.PID = #{0}
    </select>

    <select id="loadUserVehicles" resultMap="MonitorTargetDtoMap">
        SELECT A.ID, A.MOTORCADEID AS PID, A.PLATENUMBER AS NAME,
        B.DEVICENUMBER, 0
        AS `TYPE`, A.MARKER, A.ROTATE FROM vehicle AS A INNER
        JOIN device AS B
        ON A.DEVICEID=B.ID WHERE A.MOTORCADEID IN
        <foreach item="item" index="index" collection="list" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>
</mapper>