<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mmp.gps.monitor.dao.baseinfo.motorcade.IMotorcadeDao">
    <select id="list" resultType="mmp.gps.monitor.dao.baseinfo.motorcade.Motorcade">
        SELECT
            ID,
            `TYPE`,
            NAME,
            LINKMAN,
            PHONE,
            PARENTVISIBLE,
            REMARK,
            REGISTATIONDATE,
            BUSSINESSAGENT,
            COMPANYID as PID
        FROM
            motorcade
        WHERE COMPANYID = #{param1}
    </select>
    <insert id="create" parameterType="mmp.gps.monitor.dao.baseinfo.motorcade.Motorcade">
        INSERT INTO motorcade (ID,
                               COMPANYID, `TYPE`, NAME, LINKMAN, PHONE,
                               PARENTVISIBLE, REMARK,
                               REGISTATIONDATE,
                               BUSSINESSAGENT,
                               COMPANY, PID, EDITTIME)
        VALUES
        (#{id}, #{companyId}, #{type}, #{name}, #{linkMan}, #{phone},
         #{parentVisible}, #{remark},
         #{REGISTATIONDATE},
         #{BUSSINESSAGENT},
         #{COMPANY},
         #{PID}, now())
    </insert>
    <update id="update" parameterType="mmp.gps.monitor.dao.baseinfo.motorcade.Motorcade">
        UPDATE motorcade
        SET
            COMPANYID       = #{companyId},
            `TYPE`          = #{type},
            NAME            = #{name},
            LINKMAN         = #{linkMan},
            PHONE           = #{phone},
            PARENTVISIBLE   = #{parentVisible},
            REMARK          = #{remark},


            REGISTATIONDATE = #{REGISTATIONDATE},
            BUSSINESSAGENT  = #{BUSSINESSAGENT},

            EDITTIME        = now()
        WHERE ID = #{id}
            LIMIT 1
    </update>
    <delete id="delete">
        DELETE
        FROM motorcade
        WHERE ID = #{param1}
            LIMIT 1
    </delete>
    <select id="fetch" resultType="mmp.gps.monitor.dao.baseinfo.motorcade.Motorcade">
        SELECT
            ID,
            COMPANYID,
            COMPANY,
            `TYPE`,
            NAME,
            LINKMAN,
            PHONE,
            PARENTVISIBLE,
            REMARK,
            EDITTIME,
            REGISTATIONDATE,
            BUSSINESSAGENT,
            PID
        FROM motorcade
        WHERE
            ID = #{param1}
            LIMIT 1
    </select>
    <select id="exist" resultType="java.lang.Boolean">
        SELECT COUNT(1)
        FROM motorcade
        WHERE NAME = #{param1}
          AND COMPANYID = #{param1}
            LIMIT 1
    </select>
    <select id="existOutId" resultType="java.lang.Boolean">
        SELECT COUNT(1)
        FROM
            motorcade
        WHERE
            NAME = #{param1}
          AND COMPANYID = #{param2}
          AND ID != #{param3}
            LIMIT 1
    </select>
    <select id="hasVehicle" resultType="java.lang.Boolean">
        SELECT COUNT(1)
        FROM automobile
        WHERE MOTORCADEID = #{param1}
            LIMIT 1
    </select>

    <select id="selectMotorcadeByCompanyId" resultType="mmp.gps.monitor.dao.baseinfo.motorcade.Motorcade">
        SELECT
            m.ID,
            m.`NAME`,
            a.ID AS companyId
        FROM
            motorcade m
                INNER JOIN company a ON m.COMPANYID = a.ID
        WHERE
            m.COMPANYID = #{param1}
    </select>

</mapper>
