<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mmp.gps.monitor.dao.baseinfo.maintain.IMaintainDao">
    <select id="queryPageCount" resultType="java.lang.Integer">
        SELECT COUNT(1)
        FROM
            maintain AS A
                INNER JOIN automobile AS B ON A.VEHICLEID = B.ID
        WHERE
            A.COMPANYID = #{param1}
          AND B.PLATENUMBER LIKE CONCAT('%', #{param2}, '%')
          AND
            A.DONEDATE BETWEEN #{param3} AND #{param4}
    </select>
    <select id="queryPageDetail" resultType="mmp.gps.monitor.dao.baseinfo.maintain.MaintainInfo">
        SELECT
            A.ID,
            A.DONEDATE,
            A.CONTENT,
            A.MILEAGE,
            A.FEE,
            A.NEXTDATE,
            A.NEXTMILEAGE,
            A.USERNAME,
            B.PLATENUMBER
        FROM maintain AS A
                 INNER JOIN
                 automobile AS B ON
                     A.VEHICLEID = B.ID
        WHERE A.COMPANYID = #{param1}
          AND B.PLATENUMBER
            LIKE
              CONCAT('%', #{param2}, '%')
          AND A.DONEDATE BETWEEN #{param3} AND #{param4}
        ORDER BY
            A.DONEDATE
            LIMIT #{param5}, #{param6}
    </select>
    <insert id="create" parameterType="mmp.gps.monitor.dao.baseinfo.maintain.Maintain">
        INSERT INTO maintain (ID,
                              COMPANYID, VEHICLEID, DONEDATE, `TYPE`, CONTENT,
                              MILEAGE, FEE, GARAGE,
                              AGENT, NEXTDATE, NEXTMILEAGE, USERID, USERNAME,
                              USERTIME)
        VALUES
        (#{id}, #{companyId}, #{vehicleId}, #{doneDate}, #{type}, #{content},
         #{mileage}, #{fee}, #{garage}, #{agent}, #{nextDate}, #{nextMileage},
         #{userId}, #{userName}, SYSDATE())
    </insert>
    <update id="updateNextMaintainDate">
        UPDATE automobile
        SET NEXTMAINTAINDATE = #{param2}
        WHERE
            ID = #{param1}
            LIMIT 1
    </update>
    <update id="update" parameterType="mmp.gps.monitor.dao.baseinfo.maintain.Maintain">
        UPDATE maintain
        SET
            COMPANYID   = #{companyId},
            VEHICLEID   = #{vehicleId},
            DONEDATE    = #{doneDate},
            `TYPE`      = #{type},
            CONTENT     = #{content},
            MILEAGE     = #{mileage},
            FEE         = #{fee},
            GARAGE      = #{garage},
            AGENT       = #{agent},
            NEXTDATE    = #{nextDate},
            NEXTMILEAGE = #{nextMileage},
            USERID      = #{userId},
            USERNAME    = #{userName},
            USERTIME    = SYSDATE(),
            EDITTIME    = #{editTime}
        WHERE ID = #{id}

            LIMIT 1
    </update>
    <delete id="delete">
        DELETE
        FROM maintain
        WHERE ID = #{param1}
    </delete>
    <select id="fetch" resultType="mmp.gps.monitor.dao.baseinfo.maintain.Maintain">
        SELECT
            A.ID,
            A.COMPANYID,
            A.VEHICLEID,
            B.PLATENUMBER,
            A.DONEDATE,
            A.`TYPE`,
            A.CONTENT,
            A.MILEAGE,
            A.FEE,
            A.GARAGE,
            A.AGENT,
            A.NEXTDATE,
            A.NEXTMILEAGE,
            A.USERID,
            A.USERNAME,
            A.EDITTIME
        FROM maintain AS A
                 INNER JOIN automobile AS B ON
                A.VEHICLEID = B.ID
        WHERE A.ID = #{param1}
            LIMIT 1
    </select>
</mapper>
