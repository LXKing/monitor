<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.rayton.gps.dao.baseinfo.mapLayer.IMapLayerDao">
    <select id="query" resultType="com.rayton.gps.dao.baseinfo.mapLayer.MapLayerDto">
        SELECT
        ID,
        NAME,
        VISIBLE,
        REMARK
        FROM map_layer
        WHERE USERID = #{0} AND NAME LIKE
        CONCAT('%', #{1}, '%')
    </select>
    <select id="getMapLayInfo" resultType="com.rayton.gps.dao.baseinfo.mapLayer.MapLayerDto">
        SELECT
        ID,
        NAME,
        VISIBLE,
        REMARK
        FROM map_layer
        WHERE ID = #{0}
    </select>
    <insert id="create" parameterType="com.rayton.gps.dao.baseinfo.mapLayer.MapLayerDto">
        INSERT INTO map_layer (ID,
        COMPANYID, USERID, NAME, VISIBLE, REMARK) VALUES
        (#{id}, #{companyId},
        #{userId}, #{name},
        #{visible}, #{remark})
    </insert>
    <select id="fetch" resultType="com.rayton.gps.dao.baseinfo.mapLayer.MapLayerDto">
        SELECT
        ID,
        COMPANYID,
        USERID,
        NAME,
        VISIBLE,
        REMARK,
        EDITTIME
        FROM map_layer
        WHERE ID = #{0}
        LIMIT 1
    </select>
    <update id="update" parameterType="com.rayton.gps.dao.baseinfo.mapLayer.MapLayerDto">
        UPDATE map_layer
        SET
        COMPANYID = #{companyId}, USERID = #{userId}, NAME = #{name},
        VISIBLE = #{visible}, REMARK = #{remark}
        WHERE
        ID = #{id} AND
        EDITTIME = #{editTime}
        LIMIT 1
    </update>
    <delete id="delete">
        DELETE FROM map_layer
        WHERE ID = #{0}
        LIMIT 1
    </delete>
    <delete id="deleteAreaInMaplayer">
        DELETE FROM map_layer_cover
        WHERE MAPLAYERID = #{0}
    </delete>
    <insert id="addAreas">
        REPLACE INTO map_layer_cover(MAPLAYERID, AREAID, AREATYPE) VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item.key},#{item.value.key},#{item.value.value})
        </foreach>
    </insert>
    <delete id="removeArea">
        DELETE FROM map_layer_cover
        WHERE MAPLAYERID = #{0} AND
        AREAID = #{1} AND AREATYPE = #{2}
    </delete>
    <select id="getCircleAreas" resultType="java.lang.Long">
        SELECT AREAID
        FROM
        map_layer_cover
        WHERE MAPLAYERID = #{0} AND AREATYPE = 1
    </select>
    <select id="getRectangleAreas" resultType="java.lang.Long">
        SELECT AREAID
        FROM
        map_layer_cover
        WHERE MAPLAYERID = #{0} AND AREATYPE = 2
    </select>
    <select id="getPolygonAreas" resultType="java.lang.Long">
        SELECT AREAID
        FROM
        map_layer_cover
        WHERE
        MAPLAYERID = #{0} AND AREATYPE = 3
    </select>
    <select id="getRouteAreas" resultType="java.lang.Long">
        SELECT AREAID
        FROM
        map_layer_cover
        WHERE
        MAPLAYERID = #{0} AND AREATYPE = 4
    </select>
    <select id="getPois" resultType="java.lang.Long">
        SELECT AREAID
        FROM
        map_layer_cover
        WHERE
        MAPLAYERID = #{0} AND AREATYPE = 100
    </select>
    <update id="setVisible">
        UPDATE map_layer
        SET VISIBLE = #{1}
        WHERE ID = #{0}
        LIMIT
        1
    </update>
</mapper>