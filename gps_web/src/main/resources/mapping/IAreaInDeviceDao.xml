<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mmp.gps.monitor.dao.baseinfo.areaInDevice.IAreaInDeviceDao">
    <select id="assignedPageVehiclesCount" resultType="java.lang.Integer">
        SELECT COUNT(1)
        FROM equipment_region AS A
                 INNER JOIN equipment AS B ON
                A.DEVICENUMBER = B.DEVICENUMBER
                 LEFT JOIN automobile AS C ON
                B.ID = C.DEVICEID
        WHERE AREAID = #{param1}
          AND AREATYPE = #{param2}
    </select>
    <select id="assignedPageVehiclesDetail" resultType="mmp.gps.monitor.dao.baseinfo.areaInDevice.AreaInDeviceInfo">
        SELECT
            A.DEVICENUMBER,
            A.AREAID,
            A.AREATYPE,
            A.TIME,
            C.PLATENUMBER
        FROM
            equipment_region AS A
                INNER JOIN equipment AS B ON
                A.DEVICENUMBER = B.DEVICENUMBER
                LEFT JOIN automobile AS C ON
                B.ID = C.DEVICEID
        WHERE AREAID = #{param1}
          AND AREATYPE = #{param2}
        ORDER BY A.TIME
                 LIMIT
                 #{param3}, #{param4}
    </select>
    <insert id="addVehicle">
        REPLACE
        equipment_region
        SET
        DEVICENUMBER
        =
        #{param1},
        AREAID
        =
        #{param2},
        AREATYPE
        =
        #{param3},
        TIME
        =
        NOW
        (
        )
    </insert>
    <delete id="removeVehicle">
        DELETE
        FROM equipment_region
        WHERE DEVICENUMBER = #{param1}
          AND
            AREAID = #{param2}
          AND AREATYPE = #{param3}
    </delete>
    <insert id="log">
        INSERT INTO equipment_region_log (ID, DEVICENUMBER, AREAID,
                                          AREATYPE, `ACTION`,
                                          UNID, USER, SENDTIME)
        VALUES (#{param1}, #{param2}, #{param3},
                #{param4}, #{param5}, #{param6}, #{param7}, NOW())
    </insert>
    <select id="findDevice" resultType="java.lang.String">
        SELECT DEVICENUMBER
        FROM
            equipment_region
        WHERE AREAID = #{param1}
          AND AREATYPE = #{param2}
    </select>
    <delete id="deleteAreaInDevice">
        DELETE
        FROM equipment_region
        WHERE AREAID = #{param1}
          AND
            AREATYPE = #{param2}
    </delete>
    <delete id="deleteAreaInMaplayer">
        DELETE
        FROM map_layer_cover
        WHERE AREAID = #{param1}
          AND
            AREATYPE = #{param2}
    </delete>
</mapper>
