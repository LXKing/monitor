<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mmp.gps.monitor.dao.baseinfo.sectionArea.ISectionAreaDao">
    <select id="queryPageCount" resultType="java.lang.Integer">
        SELECT COUNT(1)
        FROM
            section
        WHERE COMPANYID = #{param1}
          AND NAME LIKE CONCAT('%', #{param2}, '%')
    </select>
    <select id="queryPageDetail" resultType="mmp.gps.monitor.dao.baseinfo.sectionArea.SectionAreaInfo">
        SELECT
            ID,
            NAME,
            REMARK
        FROM section
        WHERE COMPANYID = #{param1}
          AND NAME LIKE CONCAT('%', #{param2}, '%')
        ORDER BY NAME
                 LIMIT #{param3}, #{param4}
    </select>
    <select id="searchPageCount" resultType="java.lang.Integer">
        SELECT COUNT(1)
        FROM
            section
        WHERE COMPANYID = #{param1}
          AND NAME LIKE CONCAT('%', #{param2}, '%')
    </select>
    <select id="searchPageDetail" resultType="mmp.gps.monitor.dao.baseinfo.sectionArea.SectionAreaInfo">
        SELECT
            ID,
            NAME,
            REMARK
        FROM section
        WHERE COMPANYID = #{param1}
          AND NAME LIKE CONCAT('%', #{param2}, '%')
        ORDER BY NAME
                 LIMIT #{param3}, #{param4}
    </select>
    <insert id="create" useGeneratedKeys="true" keyProperty="id"
            parameterType="mmp.gps.monitor.dao.baseinfo.sectionArea.SectionArea">
        INSERT INTO section (COMPANYID, NAME, WIDTH, FLAG,
                             MAXSECONDS, MINSECONDS,
                             MAXSPEED, OVERSPEEDSECONDS, REMARK)
        VALUES
        (#{companyId}, #{name}, #{width}, #{flag}, #{maxSeconds},
         #{minSeconds}, #{maxSpeed}, #{overspeedSeconds}, #{remark})
    </insert>
    <select id="fetch" resultType="mmp.gps.monitor.dao.baseinfo.sectionArea.SectionArea">
        SELECT
            ID,
            COMPANYID,
            NAME,
            WIDTH,
            FLAG,
            MAXSECONDS,
            MINSECONDS,
            MAXSPEED,
            OVERSPEEDSECONDS,
            REMARK,
            EDITTIME
        FROM section
        WHERE ID = #{param1}
            LIMIT 1
    </select>
    <update id="update">
        UPDATE section
        SET
            COMPANYID        = #{companyId},
            NAME             = #{name},
            WIDTH            = #{width},
            FLAG             = #{flag},
            MAXSECONDS       = #{maxSeconds},
            MINSECONDS       = #{minSeconds},
            MAXSPEED         = #{maxSpeed},
            OVERSPEEDSECONDS = #{overspeedSeconds},
            REMARK           = #{remark}
        WHERE ID = #{id}
          AND
            EDITTIME = #{editTime}
            LIMIT 1
    </update>
    <delete id="delete">
        DELETE
        FROM section
        WHERE ID = #{param1}
            LIMIT 1
    </delete>
    <insert id="createSectionPoint">
        INSERT INTO route_inflection_point(SECTIONID, LAT, LNG, `INDEX`) VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item.sectionId},#{item.lat},#{item.lng},#{item.index})
        </foreach>
    </insert>
    <select id="fetchSectionPoint" resultType="mmp.gps.monitor.dao.baseinfo.sectionArea.SectionPoint">
        SELECT
            ID,
            LAT,
            LNG,
            SECTIONID,
            `INDEX`
        FROM route_inflection_point
        WHERE SECTIONID = #{param1}
        ORDER BY
            `INDEX`
    </select>
    <delete id="deleteSectionPoint">
        DELETE
        FROM route_inflection_point
        WHERE SECTIONID = #{param1}
    </delete>
    <select id="existOutId" resultType="java.lang.Boolean">
        SELECT COUNT(1)
        FROM section
        WHERE NAME = #{param1}
          AND
            COMPANYID = #{param2}
          AND ID != #{param3}
            LIMIT 1
    </select>
    <select id="exist" resultType="java.lang.Boolean">
        SELECT COUNT(1)
        FROM section
        WHERE
            NAME = #{param1}
          AND
            COMPANYID = #{param2}
            LIMIT 1
    </select>
</mapper>
