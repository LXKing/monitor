<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.rayton.gps.dao.statistics.IStatisticsDao">
    <select id="operateAllLog" resultType="com.rayton.gps.dao.security.OperateLogDto">
        SELECT
        TIME,
        USERNAME AS
        user,
        OPERATION AS action
        FROM log
        WHERE COMPANYID = #{param1} AND USERNAME
        LIKE
        CONCAT('%', #{param2}, '%') AND TIME BETWEEN #{param3} AND #{param4}
        ORDER BY TIME
    </select>
    <select id="operateLogPageCount" resultType="java.lang.Integer">
        SELECT COUNT(1)
        FROM
        log
        WHERE COMPANYID = #{param1} AND USERNAME LIKE CONCAT('%', #{param2}, '%') AND
        TIME
        BETWEEN #{param3} AND #{param4}
    </select>
    <select id="operateLogPageDetail" resultType="com.rayton.gps.dao.security.OperateLogDto">
        SELECT
        TIME,
        USERNAME AS user,
        OPERATION AS action
        FROM log
        WHERE COMPANYID = #{param1}
        AND USERNAME
        LIKE
        CONCAT('%', #{param2}, '%') AND TIME BETWEEN #{param3} AND #{param4}
        ORDER BY TIME
        LIMIT #{param5}, #{param6}
    </select>
    <select id="vehicleAlarmCount" resultType="com.rayton.gps.dao.statistics.VehicleAlarmDto">
        SELECT DEVICENUMBER AS number, ALARMS, OVAREATYPE AS ovt FROM alarm
        WHERE GPSTIME
        BETWEEN #{start} AND #{end} AND DEVICENUMBER IN
        <foreach item="item" index="index" collection="numbers" open="("
                 separator="," close=")">
            #{item}
        </foreach>
    </select>
    <select id="vehicleFatigueDrivings" resultType="com.rayton.gps.dao.statistics.TimeMileageRecord">
        SELECT
        GPSTIME AS
        TIME,
        MILEAGE
        FROM alarm
        WHERE DEVICENUMBER = #{param1} AND GPSTIME BETWEEN
        #{param2}
        AND #{param3} AND (((ALARMS &gt;&gt; 2) &amp; 1) = 1) AND OVAREATYPE = 0
        ORDER BY
        GPSTIME
    </select>
    <select id="vehicleOverspeeds" resultType="com.rayton.gps.dao.statistics.OverS">
        SELECT
        GPSTIME,
        LAT,
        LNG
        FROM
        alarm
        WHERE DEVICENUMBER = #{param1} AND GPSTIME BETWEEN #{param2} AND #{param3}
        AND
        (((ALARMS &gt;&gt; 1) &amp; 1) = 1)
        ORDER BY GPSTIME
    </select>
    <select id="sectionOverspeeds" resultType="com.rayton.gps.dao.statistics.TimeNameRecord">
        SELECT
        A.GPSTIME AS
        TIME,
        B.NAME
        FROM alarm AS A INNER JOIN section AS B ON
        A.OVAREAID = B.ID
        WHERE A.DEVICENUMBER = #{param1} AND A.GPSTIME BETWEEN #{param2}
        AND #{param3}
        AND
        (((A.ALARMS &gt;&gt; 1) &amp; 1) = 1) AND A.OVAREATYPE = 4
        ORDER
        BY A.GPSTIME
    </select>
    <select id="areaOverspeeds"
            resultType="com.rayton.gps.dao.statistics.AreaOverspeedRecord">
        SELECT
        GPSTIME AS TIME,
        NAME,
        AREATYPE
        FROM (
        SELECT
        A.GPSTIME,
        B.NAME,
        '圆形区域' AS AREATYPE
        FROM alarm AS A
        INNER JOIN circle_region AS
        B ON A.OVAREAID = B.ID
        WHERE
        A.DEVICENUMBER = #{param1} AND A.GPSTIME BETWEEN
        #{param2} AND #{param3} AND
        (((A.ALARMS &gt;&gt; 1) &amp; 1) = 1) AND A.OVAREATYPE = 1
        UNION
        SELECT
        A.GPSTIME,
        B.NAME,
        '矩形区域' AS AREATYPE
        FROM alarm AS A
        INNER
        JOIN rectangle_region
        AS B ON A.OVAREAID = B.ID
        WHERE A.DEVICENUMBER = #{param1} AND
        A.GPSTIME BETWEEN
        #{param2}
        AND #{param3} AND
        (((A.ALARMS &gt;&gt; 1) &amp; 1) = 1) AND
        A.OVAREATYPE = 2
        UNION
        SELECT
        A.GPSTIME,
        B.NAME,
        '多边形区域' AS AREATYPE
        FROM
        alarm AS A
        INNER
        JOIN
        polygon_region AS B ON A.OVAREAID = B.ID
        WHERE
        A.DEVICENUMBER = #{param1} AND
        A.GPSTIME
        BETWEEN #{param2} AND #{param3} AND
        (((A.ALARMS &gt;&gt; 1) &amp; 1) = 1) AND
        A.OVAREATYPE = 3
        ) AS T
        ORDER BY
        T.GPSTIME, T.NAME
    </select>
    <select id="timeoutParkings" resultType="java.util.Date">
        SELECT GPSTIME
        FROM
        alarm
        WHERE DEVICENUMBER = #{param1} AND GPSTIME BETWEEN #{param2} AND #{param3}
        AND
        (((ALARMS &gt;&gt; 19) &amp; 1) = 1)
        ORDER BY GPSTIME
    </select>
    <select id="routeDeviations" resultType="java.util.Date">
        SELECT GPSTIME
        FROM
        alarm
        WHERE DEVICENUMBER = #{param1} AND GPSTIME BETWEEN #{param2} AND #{param3}
        AND
        (((ALARMS &gt;&gt; 23) &amp; 1) = 1)
        ORDER BY GPSTIME
    </select>
    <select id="areaIoRecords" resultType="java.lang.Byte">
        SELECT IOAREAFLAG
        FROM
        alarm
        WHERE DEVICENUMBER = #{param1} AND GPSTIME BETWEEN #{param2} AND
        #{param3} AND
        (((ALARMS &gt;&gt; 20) &amp; 1) = 1)
    </select>
</mapper>