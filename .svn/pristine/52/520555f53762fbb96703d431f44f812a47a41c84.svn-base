<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.rayton.gps.dao.baseinfo.routeArea.IRouteAreaDao">
    <select id="queryPageCount" resultType="java.lang.Integer">
        SELECT COUNT(1)
        FROM
        route
        WHERE COMPANYID = #{param1} AND NAME LIKE CONCAT('%', #{param2}, '%')
    </select>
    <select id="queryPageDetail" resultType="com.rayton.gps.dao.baseinfo.routeArea.RouteAreaInfo">
        SELECT
        ID,
        NAME,
        DEVICECATCH,
        REMARK
        FROM route
        WHERE COMPANYID = #{param1} AND NAME
        LIKE
        CONCAT('%', #{param2}, '%')
        ORDER BY NAME
        LIMIT #{param3}, #{param4}
    </select>
    <select id="searchPageCount" resultType="java.lang.Integer">
        SELECT COUNT(1)
        FROM
        route
        WHERE COMPANYID = #{param1} AND NAME LIKE
        CONCAT('%', #{param2}, '%')
    </select>
    <select id="searchPageDetail" resultType="com.rayton.gps.dao.baseinfo.routeArea.RouteAreaInfo">
        SELECT
        ID,
        NAME,
        DEVICECATCH,
        REMARK
        FROM route
        WHERE COMPANYID = #{param1} AND NAME
        LIKE
        CONCAT('%', #{param2}, '%')
        ORDER BY NAME
        LIMIT #{param3}, #{param4}
    </select>
    <insert id="create" parameterType="com.rayton.gps.dao.baseinfo.routeArea.RouteArea">
        INSERT INTO route (COMPANYID,
        NAME, DEVICECATCH, FLAG, STARTTIME, ENDTIME,
        REMARK)
        VALUES (#{companyId}, #{name},
        #{deviceCatch}, #{flag}, #{startTime},
        #{endTime}, #{remark})
    </insert>
    <select id="fetch" resultType="com.rayton.gps.dao.baseinfo.routeArea.RouteArea">
        SELECT
        ID,
        COMPANYID,
        NAME,
        DEVICECATCH,
        FLAG,
        STARTTIME,
        ENDTIME,
        REMARK,
        EDITTIME
        FROM route
        WHERE ID = #{param1}
        LIMIT 1
    </select>
    <update id="update" parameterType="com.rayton.gps.dao.baseinfo.routeArea.RouteArea">
        UPDATE route
        SET
        COMPANYID = #{companyId}, NAME = #{name}, DEVICECATCH = #{deviceCatch},
        FLAG = #{flag}, STARTTIME = #{startTime}, ENDTIME = #{endTime},
        REMARK = #{remark}
        WHERE ID = #{id} AND EDITTIME = #{editTime}
        LIMIT 1
    </update>
    <delete id="delete">
        DELETE FROM route
        WHERE ID = #{param1}
        LIMIT 1
    </delete>
    <delete id="deleteRouteSection">
        DELETE FROM route_section
        WHERE ROUTEID = #{param1}
    </delete>
    <select id="exist" resultType="java.lang.Boolean">
        SELECT COUNT(1)
        FROM route
        WHERE
        NAME = #{param1} AND COMPANYID = #{param2}
        LIMIT 1
    </select>
    <select id="existOutId" resultType="java.lang.Boolean">
        SELECT COUNT(1)
        FROM route
        WHERE NAME = #{param1} AND COMPANYID = #{param2} AND ID != #{param3}
        LIMIT 1
    </select>
    <select id="assignedSections" resultType="com.rayton.gps.dao.baseinfo.sectionArea.SectionAreaInfo">
        SELECT
        ID,
        NAME,
        REMARK
        FROM section
        INNER JOIN route_section ON
        section.ID = route_section.SECTIONID
        WHERE route_section.ROUTEID = #{param1}
    </select>
    <insert id="addSections">
        REPLACE INTO route_section(ROUTEID, SECTIONID) VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item.key},#{item.value})
        </foreach>
    </insert>
    <delete id="removeSection">
        DELETE FROM route_section
        WHERE ROUTEID = #{param1} AND
        SECTIONID = #{param2}
        LIMIT 1
    </delete>
    <select id="fetchInfo" resultType="com.rayton.gps.dao.baseinfo.routeArea.RouteAreaInfo">
        SELECT
        ID,
        NAME,
        DEVICECATCH,
        REMARK
        FROM route
        WHERE ID = #{param1}
        LIMIT 1
    </select>
</mapper>