<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>登录页</title>
    <link rel="stylesheet" th:href="@{/static/css/login/iconfont.css}">
    <link th:href="@{/static/css/login/common.css}" rel="stylesheet"/>
    <link th:href="@{/static/css/login/index_login.css}" rel="stylesheet"/>
    <style>

        .mm {
            color: #0C0C0C;
        }

        *{
            border: none;
        }
    </style>

</head>
<body>
<div class="login_page">
    <div class="login_header clear">
        <div class="loginH_l fl">
            <img src="./static/img/login//logo.png" alt="" style="width: 45px">
            <span>锐讯易通</span>
        </div>
        <div class="loginH_r fr">
            <span>锐讯易通GPS位置服务平台</span>
        </div>
    </div>
    <div class="login_info fl">
        <div class="login_all fr">
            <p class="fr">锐讯易通GPS位置服务平台</p>
            <p class="fr">Erayton GPS location service platform.</p>
            <div class="login_box fr">
                <div class="Lbox">
                    <p>登录管理系统</p>
                    <div id="form">
                        <div class="login_ac">
                            <i>
                                <img src="./static/img/login/zhanghao-icon.png" alt="">
                            </i>
                            <input type="text" name="account" id="account">
                            <div th:text="${account}" class="mm"></div>
                        </div>
                        <div class="login_pw">
                            <i>
                                <img src="./static/img/login/mima-icon.png" alt="">
                            </i>
                            <input type="password" name="pwd" id="pwd">
                            <div th:text="${pwd}" class="mm"></div>
                        </div>
                        <div class="login_iv">
                            <i class="icon_3 iconfont icon-yanzhengma2"></i>
                            <input type="text" name="verify" id="verify">
                            <img id="btnCodeVerify" alt="验证码" src="code.verify"
                                 onClick="document.getElementById('btnCodeVerify').src='code.verify?temp='+ Math.random(); return false">
                            <div th:text="${error}" class="mm"></div>
                        </div>
                        <button id="submit" class="s_login" value="登录">登录</button>
                    </div>

                    <!--<div class="pw_info">-->
                    <!--<div class="pw_info_l fl">-->
                    <!--<input type="checkbox" class="fl">-->
                    <!--<a href="javascript:void(0)">记住密码</a>-->
                    <!--</div>-->
                    <!--<div class="pw_info_r fr">-->
                    <!--<a href="javascript:void(0)">忘记密码？</a>-->
                    <!--<a href="javascript:void(0)">注册</a>-->
                    <!--</div>-->
                    <!--</div>-->
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script th:src="@{/static/js/login/jquery.min.js}"></script>
<script th:src="@{/static/js/login/index_login.js}"></script>
<script th:src="@{/static/jsencrypt.min.js}"></script>

<script th:inline="javascript">
        var publicKey = [[${publicKey}]];
        var privateKey = [[${privateKey}]];
        console.log(publicKey);
        var encrypt = new JSEncrypt();
        encrypt.setPublicKey(publicKey);
        var encrypted = encrypt.encrypt("888888");
        var decrypt = new JSEncrypt();
        decrypt.setPrivateKey(privateKey);
        var uncrypted = decrypt.decrypt(encrypted);
        console.log(uncrypted)

        // Now a simple check to see if the round-trip worked.
        // if (uncrypted === "888888") {
        //         alert('It works!!!');
        // }
        // else {
        //         alert('Something went wrong....');
        // }
        $.ajaxSetup({
                statusCode: {
                        // HttpServletResponse.setStatus(1024);
                        1024: function (data) {
                                window.location.href = "/home";
                                // window.location.href = data.data;
                                // notify(data.data, '-light');
                        },
                    666: function (data) {
                        window.location.href = "/download";
                        // window.location.href = data.data;
                        // notify(data.data, '-light');
                    }
                }
        });
        $(function () {

                $("#submit").click(function () {

                        var encrypted = encrypt.encrypt($("#pwd").val());
                        var account = $("#account").val();
                        var pwd = encrypted;
                        var verify = $("#verify").val();
                        // console.log(account)
                        console.log(pwd)
                        // console.log(verify)

                        $.ajax({
                                url: "/",
                                type: "POST",
                                // data: $("#form").serialize(),
                                data: {
                                        account: account,
                                        pwd: pwd,
                                        verify, verify
                                },
                                success: function (res) {
                                        if (res.error === true) {
                                                $("#submit").text("用户名或密码错误");
                                                // alert("用户名或密码错误")

                                        } else if (res.ok === "false") {
                                                $("#submit").text("验证码错误");
                                                // alert("验证码错误·")
                                        }
                                        $("#btnCodeVerify").click();
                                }
                        });
                });


        });


</script>
</html>